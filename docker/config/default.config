# Multi-platform configuration with absolute paths
backend {
    default = "Local"
    
    providers {
        # Local development/testing with fixed paths
        Local {
            actor-factory = "cromwell.backend.impl.sfs.config.ConfigBackendLifecycleActorFactory"
            config {
                runtime-attributes = """
                    String? docker
                    Int cpu = 1
                    String memory = "2 GB"
                    String disk = "10 GB"
                    Int? time_minutes = 60
                """
                
                submit-docker = """
                    docker run \
                        --rm \
                        --cpus="${cpu}" \
                        --memory="${memory}" \
                        -v ${cwd}:${docker_cwd} \
                        -v /Users/kerimulterer/prsInteractive/data:/prsInteractive/data:ro \
                        -v /Users/kerimulterer/prsInteractive/results:/prsInteractive/results \
                        -v /Users/kerimulterer/prsInteractive/logs:/prsInteractive/logs \
                        -v /Users/kerimulterer/prsInteractive/config:/prsInteractive/config:ro \
                        -w ${docker_cwd} \
                        ${docker} \
                        /bin/bash ${script}
                """
                
                concurrent-job-limit = 4
            }
        }
        
        # Alternative local config with different mount strategy
        LocalAlt {
            actor-factory = "cromwell.backend.impl.sfs.config.ConfigBackendLifecycleActorFactory"
            config {
                runtime-attributes = """
                    String? docker
                    Int cpu = 1
                    String memory = "2 GB"
                    String disk = "10 GB"
                    Int? time_minutes = 60
                """
                
                submit-docker = """
                    docker run \
                        --rm \
                        --cpus="${cpu}" \
                        --memory="${memory}" \
                        -v ${cwd}:${docker_cwd} \
                        -v /Users/kerimulterer/prsInteractive:/host_prsInteractive:ro \
                        -w ${docker_cwd} \
                        ${docker} \
                        /bin/bash ${script}
                """
                
                concurrent-job-limit = 4
            }
        }
        
        # HPC/SLURM backend
        SLURM {
            actor-factory = "cromwell.backend.impl.sfs.config.ConfigBackendLifecycleActorFactory"
            config {
                runtime-attributes = """
                    String? docker
                    String? singularity
                    Int cpu = 1
                    String memory = "2 GB"
                    String disk = "10 GB"
                    Int? time_minutes = 60
                    String? partition = "compute"
                    String? account
                    String? qos
                """
                
                submit = """
                    sbatch \
                        --wait \
                        --partition=${partition} \
                        --cpus-per-task=${cpu} \
                        --mem=${memory} \
                        --time=${time_minutes} \
                        --wrap "/bin/bash ${script}"
                """
                
                submit-docker = """
                    sbatch \
                        --wait \
                        --partition=${partition} \
                        --cpus-per-task=${cpu} \
                        --mem=${memory} \
                        --time=${time_minutes} \
                        --wrap "singularity exec \
                            --bind ${cwd}:${docker_cwd} \
                            --bind /Users/kerimulterer/prsInteractive/data:/prsInteractive/data:ro \
                            --bind /Users/kerimulterer/prsInteractive/results:/prsInteractive/results \
                            docker://${docker} /bin/bash ${script}"
                """
                
                kill = "scancel ${job_id}"
                check-alive = "squeue -j ${job_id}"
                job-id-regex = "Submitted batch job (\\d+)"
            }
        }
    }
}

database {
    profile = "slick.jdbc.HsqldbProfile$"
    db {
        driver = "org.hsqldb.jdbcDriver"
        url = "jdbc:hsqldb:mem:cromwell-db;shutdown=true;hsqldb.tx=mvcc"
        connectionTimeout = 1000
    }
}
